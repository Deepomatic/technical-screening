# Non-maximum suppression (NMS) Exercise

Non-maximum suppression (NMS) is a technique used in typical object detection neural networks to avoid returning multiple predictions for a same groundtruth object. Object detectors traditionally return hundreds of proposal for a given image, and most of the proposals are very similar and often linked to a similar object. Non-maximum suppression offers a simple and efficient way to delete duplicates prediction by only keeping the best predictions that doesn't overlap with each other. 

**Example:**

![alt text](https://storage.googleapis.com/dp-missions/hiring-sa/plane.png "Plane")

You have access to:
- all the images in the `images` directory
- the ground truth boxes, checked by human annotators, in `groundtruth.json`
- the predicted boxes, generated by the detector without the NMS step, in `proposals.json`

### Ground truth

The ground truth boxes are in the following format:
```
{
  "images": [
    {
      "annotated_regions": [
        {
          "tags": [
            "avion"
          ],
          "region_type": "Box",
          "region": {
            "xmin": 0.5411571108172154,
            "xmax": 0.6228667914646092,
            "ymin": 0.32151435917628496,
            "ymax": 0.4340908938779274
          }
        }
      ],
      "location": "planes/pic6.JPG"
    }, ...
}
```


### Proposals

Each proposal predicted box is in the following format:
```
{
  "images": [
    {
      "annotated_regions": [
        {
          "tags": [
            "avion"
          ],
          "score": 0.832
          "region_type": "Box",
          "region": {
            "xmin": 0.5411571108172154,
            "xmax": 0.6228667914646092,
            "ymin": 0.32151435917628496,
            "ymax": 0.4340908938779274
          }
        }
      ],
      "location": "planes/pic6.JPG"
    }, ...
}
```

Notice that there is now a confidence score between 0 and 1.

## Task 1

After doing some research on how the NMS algorithm works, your first task is to implement a NMS function that takes a list of proposal predictions as an entry and returns a list of final predictions. For this task, you will set the threshold IoU to 0.3.

The function is called `nms` and you just need to write its body. Here are some relavant definition of the metrics you will use.

### definition: IoU

The **IoU** (intersection over union) `IoU(B1, B2)` of two boxes is defined as the surface of the intersection of the two boxes divided by the surface of the union of the two boxes.

**Remark:** the solution from this task is not expected to match with the `predictions.json` file provided in folder `2_precision_accuracy`. 

## Task 2

For the previous task we asked the threshold IoU to be set to 0.3 but this value can be adjusted depending on the type of datasets and tasks you are encountering. For this dataset, which threshold IoU would you recommend ? 

**Hint:** Computing the accuracy and recall depending on the threshold IoU should help you find the best IoU value.

In addition, and without additional computation, which threshold would you recommend for this various tasks:
- a person detector used to count the amount of person waiting for the tube at peak time to adapt traffic
- a tag detector on a production line that checks if every box has been correctly sealed.
- an apple detector embedded in a robot to collect fruits on a tree

You should provide your answer in a side file, and you should justify your choices by using your own words and graphs if need be. We aren't expecting an answer that should rise to the level of a scientific paper, but just a few lines, to simply explain your understanding of the impact of the IoU threshold in the NMS and the value you would recommend for the different use-cases. 